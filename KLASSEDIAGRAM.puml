@startuml SET-10-Klassediagram
!theme plain
skinparam backgroundColor #FEFEFE
skinparam classBackgroundColor #F0F0F0
skinparam classBorderColor #333333
skinparam arrowColor #333333

' Core classes
class Bruker {
    - id: int
    - navn: String
    - fodselsDato: LocalDate
    - brukerGruppe: BrukerGruppe
    + aktiveBilletter: ArrayList<Billett>
    + gamleBilletter: ArrayList<Billett>
    ---
    + kjopBillett(type, tid): void
    + kjopBillettTilAnnenBruker(type, tid, bruker): void
    + opdaterBillettStatus(): void
    + finnAlder(): int
}

class Billett {
    - id: int
    + type: Billett.Type (Enkel|Periode)
    + startTid: LocalDateTime
    + sluttTid: LocalDateTime
    ---
    + Billett(type, startTid)
}

class Rute {
    - id: int
    + stopp: ArrayList<Stoppested>
    ---
    + leggTilStopp(stoppested): void
    + beregnRuteLengde(): double
    + visRute(): void
}

class Stoppested {
    - id: int
    - navn: String
    - sone: int
    + avganger: ArrayList<Avgang>
    ---
    + leggTilAvgang(avgang): void
    + visAvganger(): void
    + hentAvganger(): ArrayList<Avgang>
    + getSone(): int
}

class Avgang {
    - id: int
    - ruteID: int
    - stoppestedID: int
    + tidspunkt: LocalTime
    ---
    + Avgang(id, ruteID, stoppestedID, tid)
}

class Validering {
    ---
    + {static} erBillettGyldigTid(billett): boolean
}

class GPSTjeneste {
    ---
    + {static} avstandMellomStopp(stopp1, stopp2): double
}

class Datadepot {
    + brukerCache: ArrayList<Bruker>
    + billettCache: ArrayList<Billett>
    + ruteCache: ArrayList<Rute>
    + stoppestedCache: ArrayList<Stoppested>
    + avgangCache: ArrayList<Avgang>
    ---
    + hentBruker(id): Bruker
    + hentStoppesteder(): ArrayList<Stoppested>
    + hentRuter(): ArrayList<Rute>
    + opprettBillett(billett): void
    + lagreTilDisk(): void
}

class Navigasjonstjeneste {
    + stoppesteder: ArrayList<Stoppested>
    + ruter: ArrayList<Rute>
    ---
    + FinnReiser(sok): ArrayList<Reiseforslag>
    + visStoppesteder(): void
}

class Reisesok {
    + fra: Stoppested
    + til: Stoppested
    + tidspunkt: LocalDateTime
    + dato: LocalDate
}

class Reiseforslag {
    + fra: Stoppested
    + til: Stoppested
    + tid: LocalDateTime
    + lengde: double
}

interface IDatabase {
    + serialiser(datadepot): void
    + deserialiser(datadepot): void
}

class DatabaseText implements IDatabase {
    - path: String
    ---
    + serialiser(datadepot): void
    + deserialiser(datadepot): void
}

' Application
class Main {
    - navigasjonstjeneste: Navigasjonstjeneste
    - datadepot: Datadepot
    - valgtBrukerId: Integer
    ---
    + configure(config): void
    + process(): void
    + preRun(): void
    + main(args): void
}

' Relationships
Bruker "*" -- "*" Billett : har
Rute "*" -- "*" Stoppested : inneholder
Stoppested "*" -- "*" Avgang : har
Avgang -- Rute : refererer til
Datadepot -- Bruker : administrerer
Datadepot -- Billett : administrerer
Datadepot -- Rute : administrerer
Datadepot -- Stoppested : administrerer
Navigasjonstjeneste -- Stoppested : inneholder
Navigasjonstjeneste -- Rute : inneholder
Reisesok -- Stoppested : fra/til
Reiseforslag -- Stoppested : fra/til
Validering -- Billett : validerer
Main -- Datadepot : bruker
Main -- Navigasjonstjeneste : bruker
DatabaseText -- Datadepot : persisterer

note right of Validering
  Sjekker gyldighet av billetter
  basert på tidspunkt
end note

note right of Bruker
  Har både aktive og utgåtte billetter
  som automatisk oppdateres
end note

@enduml
